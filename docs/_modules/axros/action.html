<!DOCTYPE html>
<!-- Some pieces of this template were used from https://github.com/Rapptz/discord.py/blob/master/docs/_templates/layout.html -->
<html>
    <head>
        <!-- HTML meta -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale: 1.0">
        <title>axros.action</title>
        <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
        <link rel="stylesheet" href="../../_static/codeblocks.css" type="text/css" />
        <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
        <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../searchindex.js" defer></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/custom.js"></script>
        <script src="../../_static/sidebar.js"></script>
        <script src="../../_static/lightdarkmode.js"></script>
        <link rel="shortcut icon" href="../../_static/mil_white.svg"/>
        <link rel="index" title="Index" href="../../genindex.html" />
        <link rel="search" title="Search" href="../../search.html" />
    </head>
    <body>
        <div class="main-grid">
            <header class="grid-item">
                <nav>
                    <a class="main-heading" href="../../index.html">Machine Intelligence Lab</a>
                    <div id="mil-light-dark-icon" onClick="rotateLightDark();">
                        <span class="material-icons" title=""></span>
                    </div>
                    <a href="https://github.com/uf-mil/mil" target="_blank"><img class="mil-svg" src="../../_static/github.svg" /></a>
                    <a href="https://mil.ufl.edu" target="_blank"><img class="mil-svg" src="../../_static/mil.svg" /></a>
                </nav>
            </header>
            <aside class="grid-item">
                <span id="hamburger-toggle">
                    <span class="material-icons">menu</span>
                </span>
                <div id="sidebar"><form id="search-form" role="search" class="search" action="../../search.html" method="get">
    <div class="search-wrapper">
        <input type="search" name="q" placeholder="Search documentation" />
        <button type="submit" onmousedown="searchBarClick(event, document.getElementById('search-form'));">
            <span class="material-icons">search</span>
        </button>
    </div>
</form>
<h3><a href="../../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../welcome.html">Welcome to MIL!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mechanical/index.html">Mechanical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../electrical/index.html">Electrical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/index.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subjugator/index.html">SubjuGator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../navigator/index.html">NaviGator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Software Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subjugator/reference.html">Subjugator Software Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../navigator/reference.html">Navigator Software Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infrastructure/index.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../culture.html">Culture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../branding.html">Branding</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testingprocedures.html">SubjuGator Testing Procedures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deprecated.html">Deprecated Projects</a></li>
</ul>

                </div>
            </aside>
            <main class="grid-item" role="main">
                
  <h1>Source code for axros.action</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">TracebackType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generic</span>

<span class="kn">import</span> <span class="nn">genpy</span>
<span class="kn">from</span> <span class="nn">actionlib_msgs.msg</span> <span class="kn">import</span> <span class="n">GoalID</span><span class="p">,</span> <span class="n">GoalStatus</span><span class="p">,</span> <span class="n">GoalStatusArray</span>
<span class="kn">from</span> <span class="nn">axros.exceptions</span> <span class="kn">import</span> <span class="n">AlreadySetup</span><span class="p">,</span> <span class="n">NotSetup</span>
<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">Header</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">types</span><span class="p">,</span> <span class="n">util</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.nodehandle</span> <span class="kn">import</span> <span class="n">NodeHandle</span>


<div class="viewcode-block" id="GoalManager"><a class="viewcode-back" href="../../reference/axros/api.html#axros.GoalManager">[docs]</a><span class="k">class</span> <span class="nc">GoalManager</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages the interactions between a specific goal and an action client.</span>

<span class="sd">    This class is not meant to be constructed by client objects; rather it is instantiated</span>
<span class="sd">    by the :class:`~.ActionClient` to talk to the :class:`~.SimpleActionServer`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_action_client</span><span class="p">:</span> <span class="n">ActionClient</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span><span class="p">]</span>
    <span class="n">_goal</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Goal</span>
    <span class="n">_goal_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">_feedback_futs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">]]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">action_client</span><span class="p">:</span> <span class="n">ActionClient</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span><span class="p">],</span>
        <span class="n">goal</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            action_client (ActionClient): The txROS action client to use to manage</span>
<span class="sd">                the goal.</span>
<span class="sd">            goal (Goal): The txROS goal to manage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span> <span class="o">=</span> <span class="n">action_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_goal</span> <span class="o">=</span> <span class="n">goal</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_goal_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">64</span><span class="p">)</span><span class="si">:</span><span class="s2">016x</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span><span class="o">.</span><span class="n">_goal_managers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span><span class="o">.</span><span class="n">_goal_managers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_goal_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_futs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_fut</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_think_thread</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_think</span><span class="p">())</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_think</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>

            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span><span class="o">.</span><span class="n">_goal_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span><span class="o">.</span><span class="n">_goal_type</span><span class="p">(</span>
                    <span class="n">header</span><span class="o">=</span><span class="n">Header</span><span class="p">(</span>
                        <span class="n">stamp</span><span class="o">=</span><span class="n">now</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">goal_id</span><span class="o">=</span><span class="n">GoalID</span><span class="p">(</span>
                        <span class="n">stamp</span><span class="o">=</span><span class="n">now</span><span class="p">,</span>
                        <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_goal_id</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">goal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_goal</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;axros.GoalManager at 0x</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">:</span><span class="s2">0x</span><span class="si">}</span><span class="s2">, action_client=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span><span class="si">}</span><span class="s2"> goal=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_goal</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span> <span class="nf">_status_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">status</span>

    <span class="k">def</span> <span class="nf">_result_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forget</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_fut</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_result_fut</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_feedback_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">feedback</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">):</span>
        <span class="k">del</span> <span class="n">status</span>

        <span class="n">old</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_futs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_futs</span><span class="p">,</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fut</span> <span class="ow">in</span> <span class="n">old</span><span class="p">:</span>
            <span class="n">fut</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">feedback</span><span class="p">)</span>

<div class="viewcode-block" id="GoalManager.get_result"><a class="viewcode-back" href="../../reference/axros/api.html#axros.GoalManager.get_result">[docs]</a>    <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">ActionResult</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Result</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the result of the goal from the manager.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: ???</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_fut</span></div>

<div class="viewcode-block" id="GoalManager.get_feedback"><a class="viewcode-back" href="../../reference/axros/api.html#axros.GoalManager.get_feedback">[docs]</a>    <span class="k">def</span> <span class="nf">get_feedback</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">ActionFeedback</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the feedback from all feedback :class:`asyncio.Future` objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fut</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Future</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_futs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fut</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fut</span></div>

<div class="viewcode-block" id="GoalManager.cancel"><a class="viewcode-back" href="../../reference/axros/api.html#axros.GoalManager.cancel">[docs]</a>    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Publishes a message to the action client requesting the goal to be cancelled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span><span class="o">.</span><span class="n">_cancel_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
            <span class="n">GoalID</span><span class="p">(</span>
                <span class="n">stamp</span><span class="o">=</span><span class="n">genpy</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_goal_id</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="GoalManager.forget"><a class="viewcode-back" href="../../reference/axros/api.html#axros.GoalManager.forget">[docs]</a>    <span class="k">def</span> <span class="nf">forget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Leaves the manager running, but requests for the action client to stop</span>
<span class="sd">        work on the specific goal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span><span class="o">.</span><span class="n">_goal_managers</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_client</span><span class="o">.</span><span class="n">_goal_managers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_goal_id</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="Goal"><a class="viewcode-back" href="../../reference/axros/api.html#axros.Goal">[docs]</a><span class="k">class</span> <span class="nc">Goal</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of a goal object in the axros adaptation of the Simple Action</span>
<span class="sd">    Server.</span>

<span class="sd">    .. container:: operations</span>

<span class="sd">        .. describe:: x == y</span>

<span class="sd">            Determines equality between two goals by comparing their ids. If</span>
<span class="sd">            either side is not a :class:`actionlib_msgs.msg.GoalStatus`, then</span>
<span class="sd">            the result is ``False``.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        goal (GoalStatus): The original goal message which constructs this class</span>
<span class="sd">        status (uint8): An enum representing the status of</span>
<span class="sd">        status_text (str): A string representing the status of the goal</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">goal</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">ActionGoal</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>  <span class="c1"># This needs to be defined</span>
    <span class="n">goal_id</span><span class="p">:</span> <span class="n">GoalID</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">status_text</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">goal_msg</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">ActionGoal</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">],</span>
        <span class="n">status</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">GoalStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">,</span>
        <span class="n">status_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">goal_msg</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">goal_msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="n">status_text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal_id</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rhs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="c1"># assert isinstance(self.goal, GoalStatus), f&quot;Value was {type(self.goal)}: {self.goal}&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">,</span> <span class="n">GoalStatus</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="o">.</span><span class="n">goal</span><span class="p">,</span> <span class="n">GoalStatus</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">id</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;axros.Goal at 0x</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">:</span><span class="s2">0x</span><span class="si">}</span><span class="s2">, goal=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="si">}</span><span class="s2"> status=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> status_text=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

<div class="viewcode-block" id="Goal.status_msg"><a class="viewcode-back" href="../../reference/axros/api.html#axros.Goal.status_msg">[docs]</a>    <span class="k">def</span> <span class="nf">status_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GoalStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs a GoalStatus message from the Goal class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            GoalStatus: The constructed message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">GoalStatus</span><span class="p">()</span>

        <span class="c1"># Type checking</span>
        <span class="c1"># assert isinstance(self.goal, GoalStatus), f&quot;Value was {type(self.goal)}: {self.goal}&quot;</span>

        <span class="c1"># Assemble message</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">goal_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal_id</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="k">else</span> <span class="n">GoalID</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span>
        <span class="k">return</span> <span class="n">msg</span></div></div>


<div class="viewcode-block" id="SimpleActionServer"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer">[docs]</a><span class="k">class</span> <span class="nc">SimpleActionServer</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simplified implementation of an action server. At a given time, can only at most</span>
<span class="sd">    have a current goal and a next goal. If new goals arrive with one already queued</span>
<span class="sd">    to be next, the goal with the greater timestamp will bump to other.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        &gt;&gt;&gt; # Construct a SimpleActionServer with a node handle, topic namespace, and type</span>
<span class="sd">        &gt;&gt;&gt; serv = SimpleActionServer(nh, &#39;/test_action&#39;, turtle_actionlib.msg.ShapeAction)</span>
<span class="sd">        &gt;&gt;&gt; # The server must be started before any goals can be accepted</span>
<span class="sd">        &gt;&gt;&gt; serv.start()</span>
<span class="sd">        &gt;&gt;&gt; # To accept a goal</span>
<span class="sd">        &gt;&gt;&gt; while not self.is_new_goal_available():  # Loop until there is a new goal</span>
<span class="sd">        ...     await nh.sleep(0.1)</span>
<span class="sd">        &gt;&gt;&gt; goal = serv.accept_new_goal()</span>
<span class="sd">        &gt;&gt;&gt; # To publish feedback</span>
<span class="sd">        &gt;&gt;&gt; serv.publish_feedback(ShapeFeedback())</span>
<span class="sd">        &gt;&gt;&gt; # To accept a preempt (a new goal attempted to replace the current one)</span>
<span class="sd">        &gt;&gt;&gt; if self.is_preempt_requested():</span>
<span class="sd">        ...     goal = serv.accept_new_goal()  # Automatically cancels old goal</span>
<span class="sd">        &gt;&gt;&gt; # To finish a goal</span>
<span class="sd">        &gt;&gt;&gt; serv.set_succeeded(text=&#39;Wahoo!&#39;, result=ShapeResult(apothem=1))</span>
<span class="sd">        &gt;&gt;&gt; # or</span>
<span class="sd">        &gt;&gt;&gt; serv.set_aborted(text=&#39;Something went wrong!&#39;)</span>

<span class="sd">    .. container:: operations</span>

<span class="sd">        .. describe:: async with x:</span>

<span class="sd">            On entering the block, :meth:`~.setup` is called; upon exit, :meth:`~.shutdown`</span>
<span class="sd">            is called.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO:</span>
    <span class="c1"># - implement optional callbacks for new goals</span>
    <span class="c1"># - ensure headers are correct for each message</span>

    <span class="n">goal</span><span class="p">:</span> <span class="n">Goal</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">next_goal</span><span class="p">:</span> <span class="n">Goal</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">node_handle</span><span class="p">:</span> <span class="n">NodeHandle</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">action_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Action</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span><span class="p">]],</span>
        <span class="n">goal_cb</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">preempt_cb</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span> <span class="o">=</span> <span class="n">node_handle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_requested</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">register_goal_callback</span><span class="p">(</span><span class="n">goal_cb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_preempt_callback</span><span class="p">(</span><span class="n">preempt_cb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">goal_cb</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preempt_cb</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_frequency</span> <span class="o">=</span> <span class="mf">5.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_goal_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">action_type</span><span class="p">()</span><span class="o">.</span><span class="n">action_goal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">action_type</span><span class="p">()</span><span class="o">.</span><span class="n">action_result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">action_type</span><span class="p">()</span><span class="o">.</span><span class="n">action_feedback</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_status_pub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">advertise</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s2">&quot;/status&quot;</span><span class="p">,</span> <span class="n">GoalStatusArray</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_pub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">advertise</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s2">&quot;/result&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_type</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_pub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">advertise</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s2">&quot;/feedback&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_type</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_goal_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s2">&quot;/goal&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal_cb</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s2">&quot;/cancel&quot;</span><span class="p">,</span> <span class="n">GoalID</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_cb</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_running</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="SimpleActionServer.setup"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.setup">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the action server. This must be called before the action server</span>
<span class="sd">        can be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">AlreadySetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status_pub</span><span class="o">.</span><span class="n">setup</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_result_pub</span><span class="o">.</span><span class="n">setup</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_pub</span><span class="o">.</span><span class="n">setup</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_goal_sub</span><span class="o">.</span><span class="n">setup</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_sub</span><span class="o">.</span><span class="n">setup</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_running</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="SimpleActionServer.shutdown"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.shutdown">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shuts the action server down. This must be called before the program is</span>
<span class="sd">        ended.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status_pub</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_result_pub</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_pub</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_goal_sub</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_sub</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_running</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="SimpleActionServer.is_running"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.is_running">[docs]</a>    <span class="k">def</span> <span class="nf">is_running</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the simple action server is running. Set to ``True``</span>
<span class="sd">            when :meth:`~.setup` is called; set to ``False`` when :meth:`~.shutdown`</span>
<span class="sd">            is called. This is independent of whether :meth:`~.start` or :meth:`~.stop`</span>
<span class="sd">            is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_running</span></div>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Shutdown can also be achieved by just shutting down each pub/sub</span>
        <span class="n">subs_pubs_running</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status_pub</span><span class="o">.</span><span class="n">is_running</span><span class="p">()</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_pub</span><span class="o">.</span><span class="n">is_running</span><span class="p">()</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_pub</span><span class="o">.</span><span class="n">is_running</span><span class="p">()</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal_sub</span><span class="o">.</span><span class="n">is_running</span><span class="p">()</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_sub</span><span class="o">.</span><span class="n">is_running</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">subs_pubs_running</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_running</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;always&quot;</span><span class="p">,</span> <span class="ne">ResourceWarning</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39; action server was never shutdown(). This may cause issues with this instance of ROS - please fix the errors and completely restart ROS.&quot;</span><span class="p">,</span>
                <span class="ne">ResourceWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="ne">ResourceWarning</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SimpleActionServer</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span><span class="p">]:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="ne">Exception</span><span class="p">],</span> <span class="n">exc_value</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">traceback</span><span class="p">:</span> <span class="n">TracebackType</span>
    <span class="p">):</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;axros.SimpleActionServer at 0x</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">:</span><span class="s2">0x</span><span class="si">}</span><span class="s2">, name=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39; running=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">()</span><span class="si">}</span><span class="s2"> started=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="si">}</span><span class="s2"> goal=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="si">}</span><span class="s2"> node_handle=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span> <span class="nf">register_goal_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal_cb</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="nf">_process_goal_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_cb</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">goal_cb</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_process_preempt_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preempt_cb</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preempt_cb</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">register_preempt_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preempt_cb</span> <span class="o">=</span> <span class="n">func</span>

<div class="viewcode-block" id="SimpleActionServer.start"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts the status loop for the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_loop_future</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_loop</span><span class="p">())</span></div>

<div class="viewcode-block" id="SimpleActionServer.stop"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops the status loop for the server, and clears all running goals and all</span>
<span class="sd">        goals scheduled to be run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">accept_new_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">types</span><span class="o">.</span><span class="n">Goal</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;SIMPLE ACTION SERVER: attempted to accept_new_goal without being started&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;SIMPLE ACTION SERVER: attempted to accept_new_goal when no new goal is available&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_preempted</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;New goal accepted in simple action server&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_requested</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">GoalStatus</span><span class="o">.</span><span class="n">ACTIVE</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="k">else</span> <span class="n">GoalStatus</span><span class="o">.</span><span class="n">SUCCEEDED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_publish_status</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal</span>

<div class="viewcode-block" id="SimpleActionServer.is_new_goal_available"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.is_new_goal_available">[docs]</a>    <span class="k">def</span> <span class="nf">is_new_goal_available</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the next goal is defined, or not ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SimpleActionServer.is_preempt_requested"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.is_preempt_requested">[docs]</a>    <span class="k">def</span> <span class="nf">is_preempt_requested</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the goal has been requested to be cancelled, and there is both</span>
<span class="sd">            a goal currently running and a goal scheduled to be run shortly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cancel_requested</span><span class="p">()</span></div>

<div class="viewcode-block" id="SimpleActionServer.is_cancel_requested"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.is_cancel_requested">[docs]</a>    <span class="k">def</span> <span class="nf">is_cancel_requested</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether a goal is currently active and a cancel has been requested.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancel_requested</span></div>

<div class="viewcode-block" id="SimpleActionServer.is_active"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.is_active">[docs]</a>    <span class="k">def</span> <span class="nf">is_active</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: Returns whether there is an active goal running.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_set_result</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">GoalStatus</span><span class="o">.</span><span class="n">SUCCEEDED</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SimpleActionServer: attempted to set_succeeded before starting&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SimpleActionServer: attempted to set_succeeded without a goal&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_publish_status</span><span class="p">()</span>
        <span class="n">result_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_type</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">result_msg</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="n">result_msg</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">status_msg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">result_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="SimpleActionServer.set_succeeded"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.set_succeeded">[docs]</a>    <span class="k">def</span> <span class="nf">set_succeeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the status of the current goal to be succeeded.</span>

<span class="sd">        Args:</span>
<span class="sd">            result (Optional[genpy.Message]): The message to attach in the result.</span>
<span class="sd">            text (str): The text to set in the result. Defaults to an empty string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_result</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">GoalStatus</span><span class="o">.</span><span class="n">SUCCEEDED</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleActionServer.set_aborted"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.set_aborted">[docs]</a>    <span class="k">def</span> <span class="nf">set_aborted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the status of the current goal to aborted.</span>

<span class="sd">        Args:</span>
<span class="sd">            result (Optional[genpy.Message]): The message to attach in the result.</span>
<span class="sd">            text (str): The text to set in the result. Defaults to an empty string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_result</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">GoalStatus</span><span class="o">.</span><span class="n">ABORTED</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleActionServer.set_preempted"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.set_preempted">[docs]</a>    <span class="k">def</span> <span class="nf">set_preempted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the status of the current goal to preempted.</span>

<span class="sd">        Args:</span>
<span class="sd">            result (Optional[genpy.Message]): The message to attach in the result.</span>
<span class="sd">            text (str): The text to set in the result. Defaults to an empty string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_result</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">GoalStatus</span><span class="o">.</span><span class="n">PREEMPTED</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleActionServer.publish_feedback"><a class="viewcode-back" href="../../reference/axros/api.html#axros.SimpleActionServer.publish_feedback">[docs]</a>    <span class="k">def</span> <span class="nf">publish_feedback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feedback</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Feedback</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Publishes a feedback message onto the feedback topic.</span>

<span class="sd">        Args:</span>
<span class="sd">            feedback (Optional[genpy.Message]): The optional feedback message to add</span>
<span class="sd">                to the sent message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SimpleActionServer: attempted to publish_feedback before starting&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SimpleActionServer: attempted to publish_feedback without a goal&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">feedback_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_type</span><span class="p">()</span>
        <span class="n">feedback_msg</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">status_msg</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">feedback</span><span class="p">:</span>
            <span class="n">feedback_msg</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">feedback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">feedback_msg</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_publish_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">GoalStatusArray</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">status_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">status_msg</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">status_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="o">.</span><span class="n">status_msg</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">goal</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">status_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">goal</span><span class="o">.</span><span class="n">status_msg</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_status_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_publish_status</span><span class="p">()</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_frequency</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cancel_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">GoalID</span><span class="p">):</span>
        <span class="n">cancel_current</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">cancel_next</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">stamp</span> <span class="o">!=</span> <span class="n">genpy</span><span class="o">.</span><span class="n">Time</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">stamp</span> <span class="o">&lt;</span> <span class="n">msg</span><span class="o">.</span><span class="n">stamp</span><span class="p">:</span>
                <span class="n">cancel_next</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">stamp</span> <span class="o">&lt;</span> <span class="n">msg</span><span class="o">.</span><span class="n">stamp</span><span class="p">:</span>
                <span class="n">cancel_current</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">msg</span><span class="o">.</span><span class="n">stamp</span> <span class="o">==</span> <span class="n">genpy</span><span class="o">.</span><span class="n">Time</span><span class="p">():</span>
            <span class="n">cancel_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">cancel_next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="ow">and</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="n">cancel_current</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="ow">and</span> <span class="n">msg</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="n">cancel_next</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">cancel_next</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">GoalStatus</span><span class="o">.</span><span class="n">RECALLED</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="s2">&quot;Goal canceled&quot;</span>
            <span class="n">result_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_type</span><span class="p">()</span>
            <span class="n">result_msg</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="o">.</span><span class="n">status_msg</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_result_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">result_msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_publish_status</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">cancel_current</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancel_requested</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancel_requested</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_preempt_callback</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_goal_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">ActionGoal</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">new_goal</span> <span class="o">=</span> <span class="n">Goal</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_goal</span><span class="o">.</span><span class="n">goal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># If goal field is empty, invalid goal</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Throw out duplicate goals</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="ow">and</span> <span class="n">new_goal</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="ow">and</span> <span class="n">new_goal</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">new_goal</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">stamp</span> <span class="o">==</span> <span class="n">genpy</span><span class="o">.</span><span class="n">Time</span><span class="p">()</span>
        <span class="p">):</span>  <span class="c1"># If time is not set, replace with current time</span>
            <span class="n">new_goal</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">now</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="o">.</span><span class="n">goal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>  <span class="c1"># If another goal is queued, handle conflict</span>
            <span class="c1"># If next goal is later, rejct new goal</span>
            <span class="k">if</span> <span class="n">new_goal</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">stamp</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">stamp</span><span class="p">:</span>
                <span class="n">new_goal</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">GoalStatus</span><span class="o">.</span><span class="n">REJECTED</span>
                <span class="n">new_goal</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="s2">&quot;canceled because another goal was received by the simple action server&quot;</span>
                <span class="n">result_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_type</span><span class="p">()</span>
                <span class="n">result_msg</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">now</span>
                <span class="n">result_msg</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">new_goal</span><span class="o">.</span><span class="n">status_msg</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_result_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">result_msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_publish_status</span><span class="p">(</span><span class="n">goal</span><span class="o">=</span><span class="n">new_goal</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># New goal is later so reject current next_goal</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">GoalStatus</span><span class="o">.</span><span class="n">REJECTED</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="s2">&quot;Goal bumped by newer goal&quot;</span>
                <span class="n">result_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_type</span><span class="p">()</span>
                <span class="n">result_msg</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">now</span>
                <span class="n">result_msg</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span><span class="o">.</span><span class="n">status_msg</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_result_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">result_msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_publish_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_goal</span> <span class="o">=</span> <span class="n">new_goal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_publish_status</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_preempt_callback</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_goal_callback</span><span class="p">()</span></div>


<div class="viewcode-block" id="ActionClient"><a class="viewcode-back" href="../../reference/axros/api.html#axros.ActionClient">[docs]</a><span class="k">class</span> <span class="nc">ActionClient</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Representation of an action client in axros. This works in conjunction with</span>
<span class="sd">    the :class:`~.SimpleActionServer` by sending the servers goals to execute.</span>
<span class="sd">    In response, the client receives feedback updates and the final result of the goal,</span>
<span class="sd">    which it can handle by itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node_handle</span><span class="p">:</span> <span class="n">NodeHandle</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Action</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span><span class="p">]]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            node_handle (axros.NodeHandle): Node handle used to power the action client.</span>
<span class="sd">            name (str): The name of the action client.</span>
<span class="sd">            action_type (type[genpy.Message]): The action message type used by the</span>
<span class="sd">                action client and server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span> <span class="o">=</span> <span class="n">node_handle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">=</span> <span class="n">action_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_goal_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">action_type</span><span class="p">()</span><span class="o">.</span><span class="n">action_goal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">action_type</span><span class="p">()</span><span class="o">.</span><span class="n">action_result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">action_type</span><span class="p">()</span><span class="o">.</span><span class="n">action_feedback</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_goal_managers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">GoalManager</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_goal_pub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">advertise</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s2">&quot;/goal&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal_type</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_pub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">advertise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s2">&quot;/cancel&quot;</span><span class="p">,</span> <span class="n">GoalID</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s2">&quot;/status&quot;</span><span class="p">,</span> <span class="n">GoalStatusArray</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_callback</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s2">&quot;/result&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_callback</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s2">&quot;/feedback&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_callback</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_running</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="ActionClient.setup"><a class="viewcode-back" href="../../reference/axros/api.html#axros.ActionClient.setup">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the action client. This must be called before the action client</span>
<span class="sd">        can be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">AlreadySetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_goal_pub</span><span class="o">.</span><span class="n">setup</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_pub</span><span class="o">.</span><span class="n">setup</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status_sub</span><span class="o">.</span><span class="n">setup</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_result_sub</span><span class="o">.</span><span class="n">setup</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_sub</span><span class="o">.</span><span class="n">setup</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_running</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ActionClient.shutdown"><a class="viewcode-back" href="../../reference/axros/api.html#axros.ActionClient.shutdown">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shuts down the action client. This should always be called when the action</span>
<span class="sd">        client is no longer needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_goal_pub</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_pub</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status_sub</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_result_sub</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feedback_sub</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_running</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">is_running</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_running</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;axros.ActionClient at 0x</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">:</span><span class="s2">0x</span><span class="si">}</span><span class="s2">, name=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="si">}</span><span class="s2">&#39; running=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">()</span><span class="si">}</span><span class="s2"> node_handle=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span> <span class="nf">_status_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">GoalStatusArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">status_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal_managers</span><span class="p">:</span>
                <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal_managers</span><span class="p">[</span><span class="n">status</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                <span class="n">manager</span><span class="o">.</span><span class="n">_status_callback</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_result_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">ActionResult</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Result</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal_managers</span><span class="p">:</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal_managers</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="n">manager</span><span class="o">.</span><span class="n">_result_callback</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_feedback_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">ActionFeedback</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal_managers</span><span class="p">:</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal_managers</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">goal_id</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
            <span class="n">manager</span><span class="o">.</span><span class="n">_feedback_callback</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">feedback</span><span class="p">)</span>

<div class="viewcode-block" id="ActionClient.send_goal"><a class="viewcode-back" href="../../reference/axros/api.html#axros.ActionClient.send_goal">[docs]</a>    <span class="k">def</span> <span class="nf">send_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GoalManager</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Goal</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Feedback</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Result</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends a goal to a goal manager. The goal manager is responsible for the</span>
<span class="sd">        communication between the action client and server; it assists in this process</span>
<span class="sd">        by maintaining individual :class:`asyncio.Future` objects.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotSetup: The action client has not been :meth:`~.setup`, or was previously</span>
<span class="sd">                :meth:`~.shutdown`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            GoalManager: The manager of the goal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">GoalManager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">)</span></div>

<div class="viewcode-block" id="ActionClient.cancel_all_goals"><a class="viewcode-back" href="../../reference/axros/api.html#axros.ActionClient.cancel_all_goals">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_all_goals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends a message to the mission cancellation topic requesting all goals to</span>
<span class="sd">        be cancelled.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotSetup: The action client has not been :meth:`~.setup`, or was previously</span>
<span class="sd">                :meth:`~.shutdown`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
            <span class="n">GoalID</span><span class="p">(</span>
                <span class="n">stamp</span><span class="o">=</span><span class="n">genpy</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ActionClient.cancel_goals_at_and_before_time"><a class="viewcode-back" href="../../reference/axros/api.html#axros.ActionClient.cancel_goals_at_and_before_time">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_goals_at_and_before_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">genpy</span><span class="o">.</span><span class="n">rostime</span><span class="o">.</span><span class="n">Time</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cancel all goals scheduled at and before a specific time.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: The time to reference when selecting which goals to cancel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
            <span class="n">GoalID</span><span class="p">(</span>
                <span class="n">stamp</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ActionClient.wait_for_server"><a class="viewcode-back" href="../../reference/axros/api.html#axros.ActionClient.wait_for_server">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">wait_for_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Waits for a server connection. When at least one connection is received,</span>
<span class="sd">        the function terminates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">NotSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node_handle</span><span class="p">)</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_goal_pub</span><span class="o">.</span><span class="n">get_connections</span><span class="p">())</span>
            <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cancel_pub</span><span class="o">.</span><span class="n">get_connections</span><span class="p">())</span>
            <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_status_sub</span><span class="o">.</span><span class="n">get_connections</span><span class="p">())</span>
            <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_result_sub</span><span class="o">.</span><span class="n">get_connections</span><span class="p">())</span>
            <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_feedback_sub</span><span class="o">.</span><span class="n">get_connections</span><span class="p">())</span>
        <span class="p">):</span>
            <span class="k">await</span> <span class="n">util</span><span class="o">.</span><span class="n">wall_sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># XXX bad bad bad</span></div></div>
</pre></div>

            </main>
        </div>
    </body>
</html>