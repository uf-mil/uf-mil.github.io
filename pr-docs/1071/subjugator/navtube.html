<!DOCTYPE html>
<!-- Some pieces of this template were used from https://github.com/Rapptz/discord.py/blob/master/docs/_templates/layout.html -->
<html>
    <head>
        <!-- HTML meta -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale: 1.0">
        <title>Nav Tube</title>
        <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
        <link rel="stylesheet" href="../_static/codeblocks.css" type="text/css" />
        <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
        <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../searchindex.js" defer></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/custom.js"></script>
        <script src="../_static/sidebar.js"></script>
        <script src="../_static/lightdarkmode.js"></script>
        <link rel="shortcut icon" href="../_static/mil_white.svg"/>
        <link rel="index" title="Index" href="../genindex.html" />
        <link rel="search" title="Search" href="../search.html" />
        <link rel="next" title="Watercooling" href="watercooling.html" />
        <link rel="prev" title="PID Controller" href="pid.html" />
    </head>
    <body>
        <div class="main-grid">
            <header class="grid-item">
                <nav>
                    <a class="main-heading" href="../index.html">Machine Intelligence Lab</a>
                    <div id="mil-light-dark-icon" onClick="rotateLightDark();">
                        <span class="material-icons" title=""></span>
                    </div>
                    <a href="https://github.com/uf-mil/mil" target="_blank"><img class="mil-svg" src="../_static/github.svg" /></a>
                    <a href="https://mil.ufl.edu" target="_blank"><img class="mil-svg" src="../_static/mil.svg" /></a>
                </nav>
            </header>
            <aside class="grid-item">
                <span id="hamburger-toggle">
                    <span class="material-icons">menu</span>
                </span>
                <div id="sidebar"><form id="search-form" role="search" class="search" action="../search.html" method="get">
    <div class="search-wrapper">
        <input type="search" name="q" placeholder="Search documentation" />
        <button type="submit" onmousedown="searchBarClick(event, document.getElementById('search-form'));">
            <span class="material-icons">search</span>
        </button>
    </div>
</form>
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../welcome.html">Welcome to MIL!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mechanical/index.html">Mechanical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../electrical/index.html">Electrical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/index.html">Software</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">SubjuGator</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#subjugator-8">SubjuGator 8</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="design.html">Software Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="simulating.html">Simulating</a></li>
<li class="toctree-l3"><a class="reference internal" href="enabling.html">Enabling</a></li>
<li class="toctree-l3"><a class="reference internal" href="cameras.html">Cameras</a></li>
<li class="toctree-l3"><a class="reference internal" href="pid.html">PID Controller</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">    Navigation Tube</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#navigation-computer">Navigation Computer</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#troubleshooting-the-nav-tube-connection">Troubleshooting The Nav Tube Connection</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#adis16400-16405-bmlz-imu-magnetometer">ADIS16400/16405-BMLZ IMU &amp; Magnetometer</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#calibrating-the-magnetometer">Calibrating the Magnetometer</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#important-links-and-datasheets">Important Links and Datasheets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="watercooling.html">Watercooling</a></li>
<li class="toctree-l3"><a class="reference internal" href="electrical.html">Electrical Design</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#robosub">RoboSub</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../navigator/index.html">NaviGator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Software Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Subjugator Software Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../navigator/reference.html">Navigator Software Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/index.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../culture.html">Culture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../branding.html">Branding</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testingprocedures.html">SubjuGator Testing Procedures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deprecated.html">Deprecated Projects</a></li>
</ul>

                </div>
            </aside>
            <main class="grid-item" role="main">
                
  <section id="nav-tube">
<h1>Nav Tube<a class="headerlink" href="#nav-tube" title="Permalink to this heading">¶</a></h1>
<p>One of the major components of SubjuGator 8 is the navigation (nav tube). This pressure vessel is located right below the main pressure vessel and contains all of our navigation sensors and equipment. The navigation computer located inside the vessel allows access to the data from these components through a direct ethernet connection.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This system was originally used on SubjuGator 7 and it was ported over with little to no changes in hardware. This does mean that the system will need a major overhaul for continued use of SubjuGator 8.</p>
</div>
<section id="navigation-computer">
<h2>Navigation Computer<a class="headerlink" href="#navigation-computer" title="Permalink to this heading">¶</a></h2>
<p>The navigation computer consists of a Gumstix Overo Computer-on-Module that mounts to a carrier board. The carrier board contains headers for the Teledyne Dopper Velocity Logger (DVL) connector board, Analog Devices Inertial Measurement Unit (IMU), and the pressure sensor. At one point, the navigation computer was also connected to a GPS antenna.
.. warning:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">No</span> <span class="n">documentation</span> <span class="ow">or</span> <span class="n">PCB</span> <span class="n">design</span> <span class="n">files</span> <span class="n">exist</span> <span class="k">for</span> <span class="n">the</span> <span class="n">navigation</span> <span class="n">computer</span> <span class="n">carrier</span> <span class="n">board</span> <span class="ow">and</span> <span class="n">there</span> <span class="n">are</span> <span class="n">no</span> <span class="n">more</span> <span class="n">functioning</span> <span class="n">spare</span> <span class="n">boards</span><span class="o">.</span> <span class="n">Additionally</span><span class="p">,</span> <span class="n">only</span> <span class="n">the</span> <span class="n">newer</span> <span class="n">GumStix</span> <span class="n">Overo</span> <span class="n">COM</span> <span class="n">boards</span> <span class="n">are</span> <span class="n">available</span> <span class="n">to</span> <span class="n">purchase</span> <span class="p">(</span><span class="k">with</span> <span class="n">a</span> <span class="n">lead</span> <span class="n">time</span> <span class="n">of</span> <span class="n">roughly</span> <span class="mi">1</span> <span class="n">year</span><span class="p">)</span> <span class="n">which</span> <span class="n">may</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">compatible</span> <span class="k">with</span> <span class="n">the</span> <span class="n">current</span> <span class="n">system</span><span class="o">.</span> <span class="n">Be</span> <span class="n">very</span> <span class="n">careful</span> <span class="n">when</span> <span class="n">working</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">the</span> <span class="n">navigation</span> <span class="n">tube</span><span class="o">.</span>
</pre></div>
</div>
<section id="troubleshooting-the-nav-tube-connection">
<h3>Troubleshooting The Nav Tube Connection<a class="headerlink" href="#troubleshooting-the-nav-tube-connection" title="Permalink to this heading">¶</a></h3>
<p>If you cannot ping the Navigation Computer (192.168.37.61), please ensure (in the following order) that:</p>
<ul class="simple">
<li><p>You are pinging 192.168.37.61.</p></li>
<li><p>The ethernet subconn cable has been connected between both pressure vessels.</p></li>
<li><p>You restart the sub at least once.</p></li>
<li><p>That the proper ethernet interface is configured in /etc/netplan YAML file. You may need to check ifconfig for the ‘enpXs0’ interface (where X is a whole number) if you have unplugged and replugged anything in the sub recently (especially the graphics card). Make sure to test the netplan with <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">netplan</span> <span class="pre">try</span></code> so that you don’t get locked out of the sub because of a bad configuration!</p></li>
<li><p>The ethernet cables are properly connected inside the main pressure vessel.</p></li>
<li><p>The ethernet cables and other cables are properly connected inside the Nav tube.</p></li>
<li><p>The navigation computer is receiving power AND is turned on (green AND blue light on the GumStix). Make sure to be extra careful and vigilent when opening and handling the navigation computer.</p></li>
</ul>
</section>
</section>
<section id="adis16400-16405-bmlz-imu-magnetometer">
<h2>ADIS16400/16405-BMLZ IMU &amp; Magnetometer<a class="headerlink" href="#adis16400-16405-bmlz-imu-magnetometer" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference external" href="https://www.analog.com/en/products/adis16400.html#product-overview">ADIS16400-BMLZ</a> / <a class="reference external" href="https://www.analog.com/en/products/adis16405.html#product-overview">ADIS16405-BMLZ</a> is the device responsible for tracking our position and orientation in the water. Currently, there is an ADIS16400 IMU in the sub, but it previously used an ADIS16405.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These components are obsolete! It may be difficult to find replacement parts in the future if SubjuGator 8 will see continued use…</p>
</div>
<section id="calibrating-the-magnetometer">
<h3>Calibrating the Magnetometer<a class="headerlink" href="#calibrating-the-magnetometer" title="Permalink to this heading">¶</a></h3>
<p>The magnetometer inside of the ADIS16400/16405 measures the strength of the magnetic field at the orientation it faces. We use this data in conjunction with the IMU’s gyroscopes and accelerometers to determine the orientation of the sub in the water. The process of calibrating the magnetometer is called magnetic hardsoft compensation and essentially changes how we bias the data it gives us.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Calibrating the magnetometer must be done in a pool.</p>
</div>
<p>To calibrate the magnetometer you must first collect magnetometer data (<code class="docutils literal notranslate"><span class="pre">/imu/mag_raw</span></code>) to use for the calibration script. This can be done through the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>roslaunch<span class="w"> </span>subjugator_launch<span class="w"> </span>sub8.launch
</pre></div>
</div>
<p>or if you prefer to not launch the entire sub:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>roslaunch<span class="w"> </span>subjugator_launch<span class="w"> </span>nav_box.launch<span class="w"> </span>imu:<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>Then, in a separate terminal window, navigate to a known directory start recording the rosbag by typing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>rosbag<span class="w"> </span>record<span class="w"> </span>-O<span class="w"> </span>&lt;name<span class="w"> </span>here&gt;.bag<span class="w"> </span>/imu/mag_raw
</pre></div>
</div>
<p>where &lt;name here&gt; is a substitute for whatever name you want to give to your bag (I recommend something memorable, like Frank or Penelope). This will record the bag data in the directory that the terminal window is in.</p>
<p>When you have started recording the bag, have members who are in the water rotate the sub. Only the sub should move, not the members holding onto the sub. The calibration can be done in any order, but you must complete a full roll, pitch, and yaw rotation plus have a few minutes of data with all three occurring at the same time. Once you are done collecting data, kill the recording window using <code class="docutils literal notranslate"><span class="pre">ctrl+c</span></code>.</p>
<p>Next, we must run the calibration script with our data. This script is located in <code class="docutils literal notranslate"><span class="pre">SubjuGator/drivers/magnetic_compensation/sub8_magnetic_hardsoft_compensation/scripts</span></code>. Type the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./generate_config<span class="w"> </span>&lt;path<span class="w"> </span>to<span class="w"> </span>calibration<span class="w"> </span>data<span class="w"> </span>bag<span class="w"> </span>file&gt;
</pre></div>
</div>
<p>note that this is a python script, so</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>generate_config<span class="w"> </span>&lt;path<span class="w"> </span>to<span class="w"> </span>calibration<span class="w"> </span>data<span class="w"> </span>bag<span class="w"> </span>file&gt;
</pre></div>
</div>
<p>is also valid.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the script fails because of the <code class="docutils literal notranslate"><span class="pre">fit_ellipsoid</span></code> method and the points on the first figure are colinear or nearly colinear you may not have collected thorough enough data. The alternate possibility is a malfunctioning magnetometer.</p>
</div>
<p>The output of the script should be a 3x3 matrix labeled <code class="docutils literal notranslate"><span class="pre">scale</span></code> and a length 3 vector labeled <code class="docutils literal notranslate"><span class="pre">shift</span></code>. These values go into the <code class="docutils literal notranslate"><span class="pre">scale</span></code> and <code class="docutils literal notranslate"><span class="pre">shift</span></code> values located inside of <code class="docutils literal notranslate"><span class="pre">subjugator_launch/launch/subsystems/nav_box.launch</span></code>.</p>
<p>After running <code class="docutils literal notranslate"><span class="pre">cm</span></code>, you will have (hopefully) successfully calibrated the magnetometer. Make sure to test the sub after calibration to see if the new configuration values are an improvement over the old ones.</p>
</section>
</section>
<section id="important-links-and-datasheets">
<h2>Important Links and Datasheets<a class="headerlink" href="#important-links-and-datasheets" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.analog.com/media/en/technical-documentation/data-sheets/ADIS16400_16405.pdf">ADIS16400/ADIS16405 Datasheet</a></p></li>
</ul>
</section>
</section>


            </main>
        </div>
    </body>
</html>