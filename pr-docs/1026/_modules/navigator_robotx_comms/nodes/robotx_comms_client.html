<!DOCTYPE html>
<!-- Some pieces of this template were used from https://github.com/Rapptz/discord.py/blob/master/docs/_templates/layout.html -->
<html>
    <head>
        <!-- HTML meta -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale: 1.0">
        <title>navigator_robotx_comms.nodes.robotx_comms_client</title>
        <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
        <link rel="stylesheet" href="../../../_static/codeblocks.css" type="text/css" />
        <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
        <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../searchindex.js" defer></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="../../../_static/custom.js"></script>
        <script src="../../../_static/sidebar.js"></script>
        <script src="../../../_static/lightdarkmode.js"></script>
        <link rel="shortcut icon" href="../../../_static/mil_white.svg"/>
        <link rel="index" title="Index" href="../../../genindex.html" />
        <link rel="search" title="Search" href="../../../search.html" />
    </head>
    <body>
        <div class="main-grid">
            <header class="grid-item">
                <nav>
                    <a class="main-heading" href="../../../index.html">Machine Intelligence Lab</a>
                    <div id="mil-light-dark-icon" onClick="rotateLightDark();">
                        <span class="material-icons" title=""></span>
                    </div>
                    <a href="https://github.com/uf-mil/mil" target="_blank"><img class="mil-svg" src="../../../_static/github.svg" /></a>
                    <a href="https://mil.ufl.edu" target="_blank"><img class="mil-svg" src="../../../_static/mil.svg" /></a>
                </nav>
            </header>
            <aside class="grid-item">
                <span id="hamburger-toggle">
                    <span class="material-icons">menu</span>
                </span>
                <div id="sidebar"><form id="search-form" role="search" class="search" action="../../../search.html" method="get">
    <div class="search-wrapper">
        <input type="search" name="q" placeholder="Search documentation" />
        <button type="submit" onmousedown="searchBarClick(event, document.getElementById('search-form'));">
            <span class="material-icons">search</span>
        </button>
    </div>
</form>
<h3><a href="../../../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../welcome.html">Welcome to MIL!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mechanical/index.html">Mechanical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../electrical/index.html">Electrical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software/index.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../subjugator/index.html">SubjuGator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../navigator/index.html">NaviGator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Software Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../subjugator/reference.html">Subjugator Software Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../navigator/reference.html">Navigator Software Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design/design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infrastructure/index.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../culture.html">Culture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../branding.html">Branding</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../testingprocedures.html">Testing Procedures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../deprecated.html">Deprecated Projects</a></li>
</ul>

                </div>
            </aside>
            <main class="grid-item" role="main">
                
  <h1>Source code for navigator_robotx_comms.nodes.robotx_comms_client</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RobotX Communications: A node that handles message communications</span>
<span class="sd">with the Technical Director server for the RobotX Communication Protocol</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">IntEnum</span>

<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">PointStamped</span>
<span class="kn">from</span> <span class="nn">mil_tools</span> <span class="kn">import</span> <span class="n">thread_lock</span>
<span class="kn">from</span> <span class="nn">nav_msgs.msg</span> <span class="kn">import</span> <span class="n">Odometry</span>
<span class="kn">from</span> <span class="nn">navigator_msgs.msg</span> <span class="kn">import</span> <span class="n">ScanTheCode</span>
<span class="kn">from</span> <span class="nn">navigator_msgs.srv</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">MessageDetectDock</span><span class="p">,</span>
    <span class="n">MessageDetectDockRequest</span><span class="p">,</span>
    <span class="n">MessageDetectDockResponse</span><span class="p">,</span>
    <span class="n">MessageEntranceExitGate</span><span class="p">,</span>
    <span class="n">MessageEntranceExitGateRequest</span><span class="p">,</span>
    <span class="n">MessageEntranceExitGateResponse</span><span class="p">,</span>
    <span class="n">MessageFindFling</span><span class="p">,</span>
    <span class="n">MessageFindFlingRequest</span><span class="p">,</span>
    <span class="n">MessageFindFlingResponse</span><span class="p">,</span>
    <span class="n">MessageFollowPath</span><span class="p">,</span>
    <span class="n">MessageFollowPathRequest</span><span class="p">,</span>
    <span class="n">MessageFollowPathResponse</span><span class="p">,</span>
    <span class="n">MessageReactReport</span><span class="p">,</span>
    <span class="n">MessageReactReportRequest</span><span class="p">,</span>
    <span class="n">MessageReactReportResponse</span><span class="p">,</span>
    <span class="n">MessageUAVReplenishment</span><span class="p">,</span>
    <span class="n">MessageUAVReplenishmentRequest</span><span class="p">,</span>
    <span class="n">MessageUAVReplenishmentResponse</span><span class="p">,</span>
    <span class="n">MessageUAVSearchReport</span><span class="p">,</span>
    <span class="n">MessageUAVSearchReportRequest</span><span class="p">,</span>
    <span class="n">MessageUAVSearchReportResponse</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">navigator_robotx_comms.navigator_robotx_comms</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RobotXDetectDockMessage</span><span class="p">,</span>
    <span class="n">RobotXEntranceExitGateMessage</span><span class="p">,</span>
    <span class="n">RobotXFindFlingMessage</span><span class="p">,</span>
    <span class="n">RobotXFollowPathMessage</span><span class="p">,</span>
    <span class="n">RobotXHeartbeatMessage</span><span class="p">,</span>
    <span class="n">RobotXReactReportMessage</span><span class="p">,</span>
    <span class="n">RobotXScanCodeMessage</span><span class="p">,</span>
    <span class="n">RobotXUAVReplenishmentMessage</span><span class="p">,</span>
    <span class="n">RobotXUAVSearchReportMessage</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ros_alarms</span> <span class="kn">import</span> <span class="n">AlarmListener</span>
<span class="kn">from</span> <span class="nn">ros_alarms_msg.msg</span> <span class="kn">import</span> <span class="n">Alarm</span>
<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>

<span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">SystemModes</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumerates constants of friendly system mode names to ints</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">KILLED</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">AUTONOMOUS</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">REMOTE_CONTROLLED</span> <span class="o">=</span> <span class="mi">1</span>


<div class="viewcode-block" id="RobotXStartServices"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices">[docs]</a><span class="k">class</span> <span class="nc">RobotXStartServices</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes services and subscribes to necessary publishers in order to facilitate</span>
<span class="sd">    the transmission of messages between the robot client and the Technical Director</span>
<span class="sd">    server.</span>

<span class="sd">    This class is part of a node that should be launched when communication is necessary</span>
<span class="sd">    with official AUVSI software.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        robotx_client (RobotXClient): The client used to connect with the Technical</span>
<span class="sd">            Director server.</span>
<span class="sd">        system_mode (int): The mode of the system.</span>
<span class="sd">        wrench (str): The current wrench mode of the system. For example, ``autonomous``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># define all variables for subscribers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_array</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">odom</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uav_status</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_mode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrench</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kill</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># define delimiter for messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delim</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span>
        <span class="c1"># define parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s2">&quot;~team_id&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">td_ip</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s2">&quot;~td_ip&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">td_port</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s2">&quot;~td_port&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_test_data</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s2">&quot;~use_test_data&quot;</span><span class="p">)</span>
        <span class="c1"># time last called</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_entrance_exit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_follow_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_react_report</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_find_fling</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_uav_replenishment</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_uav_search_report</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_scan_code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_detect_dock</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># initialize connection to server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_client</span> <span class="o">=</span> <span class="n">RobotXClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">td_ip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">td_port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

        <span class="c1"># setup all message types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_heartbeat_message</span> <span class="o">=</span> <span class="n">RobotXHeartbeatMessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_entrance_exit_gate_message</span> <span class="o">=</span> <span class="n">RobotXEntranceExitGateMessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_scan_code_message</span> <span class="o">=</span> <span class="n">RobotXScanCodeMessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_detect_dock_message</span> <span class="o">=</span> <span class="n">RobotXDetectDockMessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_follow_path_message</span> <span class="o">=</span> <span class="n">RobotXFollowPathMessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_react_report_message</span> <span class="o">=</span> <span class="n">RobotXReactReportMessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_find_fling_message</span> <span class="o">=</span> <span class="n">RobotXFindFlingMessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_uav_replenishment_message</span> <span class="o">=</span> <span class="n">RobotXUAVReplenishmentMessage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_uav_search_report_message</span> <span class="o">=</span> <span class="n">RobotXUAVSearchReportMessage</span><span class="p">()</span>

        <span class="c1"># setup all subscribers</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s2">&quot;lla&quot;</span><span class="p">,</span> <span class="n">PointStamped</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gps_coord_callback</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s2">&quot;odom&quot;</span><span class="p">,</span> <span class="n">Odometry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gps_odom_callback</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s2">&quot;/wrench/selected&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrench_callback</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s2">&quot;/scan_the_code&quot;</span><span class="p">,</span> <span class="n">ScanTheCode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_the_code_callback</span><span class="p">)</span>

        <span class="c1"># TODO: setup subscriber for uav status callback update</span>

        <span class="c1"># track kill state for inferring system mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kill_listener</span> <span class="o">=</span> <span class="n">AlarmListener</span><span class="p">(</span><span class="s2">&quot;kill&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kill_callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kill_listener</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">()</span>

        <span class="c1"># setup all services</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_entrance_exit_gate_message</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span>
            <span class="s2">&quot;entrance_exit_gate_message&quot;</span><span class="p">,</span>
            <span class="n">MessageEntranceExitGate</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_entrance_exit_gate_message</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_follow_path_message</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span>
            <span class="s2">&quot;follow_path_message&quot;</span><span class="p">,</span>
            <span class="n">MessageFollowPath</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_follow_path_message</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_react_report_message</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span>
            <span class="s2">&quot;react_report_message&quot;</span><span class="p">,</span>
            <span class="n">MessageReactReport</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_react_report_message</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_detect_dock_message</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span>
            <span class="s2">&quot;detect_dock_message&quot;</span><span class="p">,</span>
            <span class="n">MessageDetectDock</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_detect_dock_message</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_find_fling_message</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span>
            <span class="s2">&quot;find_fling_message&quot;</span><span class="p">,</span>
            <span class="n">MessageFindFling</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_find_fling_message</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_uav_replenishment_message</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span>
            <span class="s2">&quot;uav_replenishment_message&quot;</span><span class="p">,</span>
            <span class="n">MessageUAVReplenishment</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_uav_replenishment_message</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_uav_search_report_message</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span>
            <span class="s2">&quot;uav_search_report_message&quot;</span><span class="p">,</span>
            <span class="n">MessageUAVSearchReport</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_uav_search_report_message</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># start sending heartbeat every second</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_heartbeat_message</span><span class="p">)</span>

<div class="viewcode-block" id="RobotXStartServices.update_system_mode"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.update_system_mode">[docs]</a>    <span class="k">def</span> <span class="nf">update_system_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets :attr:`.system_mode` according to whether the kill is ``True`` and the mode</span>
<span class="sd">        of the boat.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kill</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_mode</span> <span class="o">=</span> <span class="n">SystemModes</span><span class="o">.</span><span class="n">KILLED</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrench</span> <span class="o">==</span> <span class="s2">&quot;autonomous&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrench</span> <span class="o">==</span> <span class="s2">&quot;/wrench/autonomous&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_mode</span> <span class="o">=</span> <span class="n">SystemModes</span><span class="o">.</span><span class="n">AUTONOMOUS</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_mode</span> <span class="o">=</span> <span class="n">SystemModes</span><span class="o">.</span><span class="n">REMOTE_CONTROLLED</span></div>

<div class="viewcode-block" id="RobotXStartServices.wrench_callback"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.wrench_callback">[docs]</a>    <span class="k">def</span> <span class="nf">wrench_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrench</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the :attr:`.wrench` attribute with the most recent wrench value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrench</span> <span class="o">=</span> <span class="n">wrench</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="RobotXStartServices.kill_callback"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.kill_callback">[docs]</a>    <span class="k">def</span> <span class="nf">kill_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alarm</span><span class="p">:</span> <span class="n">Alarm</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the :attr:`.kill` attribute depending on whether the most recent</span>
<span class="sd">        alarm received by the boat was raised or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kill</span> <span class="o">=</span> <span class="n">alarm</span><span class="o">.</span><span class="n">raised</span></div>

<div class="viewcode-block" id="RobotXStartServices.gps_coord_callback"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.gps_coord_callback">[docs]</a>    <span class="k">def</span> <span class="nf">gps_coord_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lla</span><span class="p">:</span> <span class="n">PointStamped</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the :attr:`.gps_array` attribute with the most recent :class:`PointStamped`</span>
<span class="sd">        message received.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_array</span> <span class="o">=</span> <span class="n">lla</span></div>

<div class="viewcode-block" id="RobotXStartServices.gps_odom_callback"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.gps_odom_callback">[docs]</a>    <span class="k">def</span> <span class="nf">gps_odom_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">odom</span><span class="p">:</span> <span class="n">Odometry</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the most recent :class:`Odometry` message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">odom</span> <span class="o">=</span> <span class="n">odom</span></div>

<div class="viewcode-block" id="RobotXStartServices.uav_status_callback"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.uav_status_callback">[docs]</a>    <span class="k">def</span> <span class="nf">uav_status_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uav_status</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the most recent AUV status experienced by the boat.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uav_status</span> <span class="o">=</span> <span class="n">uav_status</span></div>

<div class="viewcode-block" id="RobotXStartServices.system_mode_callback"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.system_mode_callback">[docs]</a>    <span class="k">def</span> <span class="nf">system_mode_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system_mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the class&#39; :attr:`system_mode` attribute when given the most recent</span>
<span class="sd">        system mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_mode</span> <span class="o">=</span> <span class="n">system_mode</span></div>

<div class="viewcode-block" id="RobotXStartServices.scan_the_code_callback"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.scan_the_code_callback">[docs]</a>    <span class="k">def</span> <span class="nf">scan_the_code_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scan_the_code</span><span class="p">:</span> <span class="n">ScanTheCode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the ScanTheCode message requests by calling :meth:`.handle_scan_code_message`</span>
<span class="sd">        with the color pattern specified in the message.</span>

<span class="sd">        Args:</span>
<span class="sd">            scan_the_code (ScanTheCode): The message to format and send to the Technical</span>
<span class="sd">                Director server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_scan_code_message</span><span class="p">(</span><span class="n">scan_the_code</span><span class="o">.</span><span class="n">color_pattern</span><span class="p">)</span></div>

<div class="viewcode-block" id="RobotXStartServices.handle_heartbeat_message"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.handle_heartbeat_message">[docs]</a>    <span class="k">def</span> <span class="nf">handle_heartbeat_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs a heartbeat message according to a timer and sends the formatted</span>
<span class="sd">        message to the AUVSI Technical Director station.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_system_mode</span><span class="p">()</span>
        <span class="n">aedt_date_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aedt_date_time</span><span class="p">()</span>

        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robotx_heartbeat_message</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delim</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">,</span>
            <span class="n">aedt_date_time</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gps_array</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">odom</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uav_status</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system_mode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_test_data</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="RobotXStartServices.handle_entrance_exit_gate_message"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.handle_entrance_exit_gate_message">[docs]</a>    <span class="k">def</span> <span class="nf">handle_entrance_exit_gate_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">MessageEntranceExitGateRequest</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MessageEntranceExitGateResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles requests to make messages to use in the Entrance and Exit Gate</span>
<span class="sd">        mission.</span>

<span class="sd">        Args:</span>
<span class="sd">            data (MessageEntranceExitGateRequest): The request to the service.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MessageEntranceExitGateResponse: The response from the service. The response</span>
<span class="sd">            contains the message needed to send to AUVSI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_entrance_exit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seconds_elapsed</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_entrance_exit</span>
            <span class="k">if</span> <span class="n">seconds_elapsed</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">seconds_elapsed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_entrance_exit</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="n">aedt_date_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aedt_date_time</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robotx_entrance_exit_gate_message</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delim</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">,</span>
            <span class="n">aedt_date_time</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_test_data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MessageEntranceExitGateResponse</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="RobotXStartServices.handle_follow_path_message"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.handle_follow_path_message">[docs]</a>    <span class="k">def</span> <span class="nf">handle_follow_path_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">MessageFollowPathRequest</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MessageFollowPathResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles requests to make messages to use in the Follow Path Mission</span>

<span class="sd">        Args:</span>
<span class="sd">            data (MessageFollowPathRequest): The request to the service.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MessageFollowPathResponse: The response from the service. The response</span>
<span class="sd">            contains the message needed to send to AUVSI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_follow_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seconds_elapsed</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_follow_path</span>
            <span class="k">if</span> <span class="n">seconds_elapsed</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">seconds_elapsed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_follow_path</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="n">aedt_date_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aedt_date_time</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robotx_follow_path_message</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delim</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">,</span>
            <span class="n">aedt_date_time</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_test_data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MessageFollowPathResponse</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="RobotXStartServices.handle_react_report_message"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.handle_react_report_message">[docs]</a>    <span class="k">def</span> <span class="nf">handle_react_report_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">MessageReactReportRequest</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MessageReactReportResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles requests to make messages to use in the React Report Mission</span>

<span class="sd">        Args:</span>
<span class="sd">            data (MessageReactReportRequest): The request to the service.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MessageReactReportResponse: The response from the service. The response</span>
<span class="sd">            contains the message needed to send to AUVSI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_react_report</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seconds_elapsed</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_react_report</span>
            <span class="k">if</span> <span class="n">seconds_elapsed</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">seconds_elapsed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_react_report</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="n">aedt_date_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aedt_date_time</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robotx_react_report_message</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delim</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">,</span>
            <span class="n">aedt_date_time</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_test_data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MessageReactReportResponse</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="RobotXStartServices.handle_scan_code_message"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.handle_scan_code_message">[docs]</a>    <span class="k">def</span> <span class="nf">handle_scan_code_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the color pattern reported over the topic dedicated to the Scan the Code</span>
<span class="sd">        mission.</span>

<span class="sd">        The color is encoded into a message and sent to the AUVSI Technical Director</span>
<span class="sd">        server.</span>

<span class="sd">        Args:</span>
<span class="sd">            color_pattern (str): The color pattern reported by the handled message</span>
<span class="sd">                in the Scan the Code topic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_scan_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seconds_elapsed</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_scan_code</span>
            <span class="k">if</span> <span class="n">seconds_elapsed</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">seconds_elapsed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_scan_code</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="n">aedt_date_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aedt_date_time</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robotx_scan_code_message</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delim</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">,</span>
            <span class="n">aedt_date_time</span><span class="p">,</span>
            <span class="n">color_pattern</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_test_data</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="RobotXStartServices.handle_detect_dock_message"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.handle_detect_dock_message">[docs]</a>    <span class="k">def</span> <span class="nf">handle_detect_dock_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">MessageDetectDockRequest</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MessageDetectDockResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles requests to make messages to use in the Detect Dock Mission</span>

<span class="sd">        Args:</span>
<span class="sd">            data (MessageDetectDockRequest): The request to the service.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MessageDetectDockResponse: The response from the service. The response</span>
<span class="sd">            contains the message needed to send to AUVSI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_detect_dock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seconds_elapsed</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_detect_dock</span>
            <span class="k">if</span> <span class="n">seconds_elapsed</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">seconds_elapsed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_detect_dock</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="n">aedt_date_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aedt_date_time</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robotx_detect_dock_message</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delim</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">,</span>
            <span class="n">aedt_date_time</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_test_data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MessageDetectDockResponse</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="RobotXStartServices.handle_find_fling_message"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.handle_find_fling_message">[docs]</a>    <span class="k">def</span> <span class="nf">handle_find_fling_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">MessageFindFlingRequest</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MessageFindFlingResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles requests to make messages to use in the Find Fling Mission</span>

<span class="sd">        Args:</span>
<span class="sd">            data (MessageFindFlingRequest): The request to the service.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MessageFindFlingResponse: The response from the service. The response</span>
<span class="sd">            contains the message needed to send to AUVSI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_find_fling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seconds_elapsed</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_find_fling</span>
            <span class="k">if</span> <span class="n">seconds_elapsed</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">seconds_elapsed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_find_fling</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="n">aedt_date_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aedt_date_time</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robotx_find_fling_message</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delim</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">,</span>
            <span class="n">aedt_date_time</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_test_data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MessageFindFlingResponse</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="RobotXStartServices.handle_uav_replenishment_message"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.handle_uav_replenishment_message">[docs]</a>    <span class="k">def</span> <span class="nf">handle_uav_replenishment_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">MessageUAVReplenishmentRequest</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MessageUAVReplenishmentResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles requests to make messages to use in the UAV Replenishment Mission</span>

<span class="sd">        Args:</span>
<span class="sd">            data (MessageUAVReplenishmentRequest): The request to the service.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MessageUAVReplenishmentResponse: The response from the service. The response</span>
<span class="sd">            contains the message needed to send to AUVSI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_uav_replenishment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seconds_elapsed</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_uav_replenishment</span>
            <span class="k">if</span> <span class="n">seconds_elapsed</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">seconds_elapsed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_uav_replenishment</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="n">aedt_date_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aedt_date_time</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robotx_uav_replenishment_message</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delim</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">,</span>
            <span class="n">aedt_date_time</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_test_data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MessageUAVReplenishmentResponse</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="RobotXStartServices.handle_uav_search_report_message"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.handle_uav_search_report_message">[docs]</a>    <span class="k">def</span> <span class="nf">handle_uav_search_report_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">MessageUAVSearchReportRequest</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MessageUAVSearchReportResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles requests to make messages to use in the UAV Search Report Mission</span>

<span class="sd">        Args:</span>
<span class="sd">            data (MessageUAVSearchReportRequest): The request to the service.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MessageUAVSearchReportResponse: The response from the service. The response</span>
<span class="sd">            contains the message needed to send to AUVSI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_uav_search_report</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seconds_elapsed</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_last_uav_search_report</span>
            <span class="k">if</span> <span class="n">seconds_elapsed</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">seconds_elapsed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_last_uav_search_report</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="n">aedt_date_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_aedt_date_time</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robotx_uav_search_report_message</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delim</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">team_id</span><span class="p">,</span>
            <span class="n">aedt_date_time</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_test_data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">robotx_client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MessageUAVSearchReportResponse</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="RobotXStartServices.get_aedt_date_time"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXStartServices.get_aedt_date_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_aedt_date_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the current time in AEDT in the format of ``%d%m%y{self.delim}%H%M%S``.</span>
<span class="sd">        This is the format specified by AUVSI to use in messages.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The constructed string representing the date and time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># AEDT is 11 hours ahead of UTC</span>
        <span class="n">aedt_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">date_string</span> <span class="o">=</span> <span class="n">aedt_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">%m%y&quot;</span><span class="p">)</span>
        <span class="n">time_string</span> <span class="o">=</span> <span class="n">aedt_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H%M%S&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">date_string</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delim</span> <span class="o">+</span> <span class="n">time_string</span></div></div>


<div class="viewcode-block" id="RobotXClient"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXClient">[docs]</a><span class="k">class</span> <span class="nc">RobotXClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles communication with Technical Director server at the AUVSI RobotX competition.</span>

<span class="sd">    This class is generally handled by :class:`RobotXStartServices`.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        tcp_port (int): The TCP port allotted for communication between MIL and the</span>
<span class="sd">            Technical Director server at the competition site.</span>
<span class="sd">        connected (bool): Whether a connection is intact between the client and the</span>
<span class="sd">            Technical Director server.</span>
<span class="sd">        socket_connection (Optional[socket.socket]): The socket connection. This is</span>
<span class="sd">            initially set to ``None``, until it is made in :meth:`.connect`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tcp_ip</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tcp_port</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            tcp_ip (str): The IP address used by the Technical Director server to connect to.</span>
<span class="sd">            tcp_port (int): The port used by the Technical Director server that MIL</span>
<span class="sd">                is asked to connect to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tcp_ip</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">tcp_ip</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">logwarn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to resolved </span><span class="si">{</span><span class="n">tcp_ip</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="k">continue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcp_port</span> <span class="o">=</span> <span class="n">tcp_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket_connection</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="RobotXClient.connect"><a class="viewcode-back" href="../../../navigator/reference.html#navigator_robotx_comms.nodes.robotx_comms_client.RobotXClient.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to establish a socket connection at the given IP and port number</span>
<span class="sd">        if no connection has already been established.</span>

<span class="sd">        If a connection can not be established, then the method sleeps for 2 seconds</span>
<span class="sd">        before retrying to establish a connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span>
                <span class="s2">&quot;Attempting Connection to TD Server at </span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tcp_ip</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tcp_port</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
            <span class="c1"># recreate socket</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket_connection</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="c1"># attempt to reconnect, otherwise sleep for 2 seconds</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket_connection</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tcp_ip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcp_port</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Connection to TD Server Successful&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div>

    <span class="nd">@thread_lock</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends a message over the established socket connection. This method is thread-locked.</span>

<span class="sd">        If any error occurs in the transmission of the packet, then :attr:`.connection`</span>
<span class="sd">        is immediately set to ``False``, and a connection is attempted to be re-established</span>
<span class="sd">        through :meth:`.connect`.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (bytes): The message to send over the connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;ascii&quot;</span><span class="p">))</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Connection to TD Server Lost&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s2">&quot;robotx_comms_client&quot;</span><span class="p">)</span>
    <span class="n">robotx_start_services</span> <span class="o">=</span> <span class="n">RobotXStartServices</span><span class="p">()</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span>
</pre></div>

            </main>
        </div>
    </body>
</html>